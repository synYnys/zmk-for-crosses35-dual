/* crosses_left.overlay */

&spi1 {
    trackball_peripheral@0 {
        /* 1. ドライバ側の設定はすべて「標準（反転なし）」に戻します */
        /* これで基準を統一します */
        cpi = <300>;
        /delete-property/ x-invert;
        /delete-property/ y-invert;
    };
};

/ {
    /* 2. 減速装置（1/12スピード） */
    scaler_slow: scaler_slow {
        compatible = "zmk,input-processor-scaler";
        #input-processor-cells = <2>;
        type = <0x02>;
        codes = <0x00 0x01>;
        track-remainders;
    };

    /* 3. 【新設】強制反転装置（インバーター） */
    /* これでソフト的に確実に上下左右をひっくり返します */
    xy_inverter: xy_inverter {
        compatible = "zmk,input-processor-transform";
        #input-processor-cells = <0>;
        type = <0x02>;
        x-codes = <0x00>;
        y-codes = <0x01>;
        x-invert; /* 縦を反転 */
        y-invert; /* 横を反転 */
    };

    /* 4. 適用（順番：減速 → 反転 → スクロール変換 → 通信制限） */
    split_inputs {
        trackball_peripheral_split@0 {
            input-processors = <&scaler_slow 1 12>, <&xy_inverter>, <&zip_xy_to_scroll_mapper>, <&zip_ble_report_rate_limit>;
        };
    };
};
